<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Trivia + Ruleta</title>

<style>
body {
  background: #111;
  color: white;
  font-family: Arial, sans-serif;
  text-align: center;
}

.hidden { display: none; }

button {
  padding: 12px 20px;
  font-size: 18px;
  cursor: pointer;
  margin-top: 15px;
}

.opcion {
  display: block;
  margin: 10px auto;
  padding: 10px;
  width: 70%;
  font-size: 18px;
}

.correcta { background: green; color: white; }
.incorrecta { background: red; color: white; }

canvas {
  margin-top: 20px;
}
</style>
</head>

<body>

<!-- ================= FORMULARIO ================= -->
<div id="formulario">
  <h2>Participa y gana</h2>
  <input id="nombre" placeholder="Nombre"><br><br>
  <input id="telefono" placeholder="Tel√©fono"><br><br>
  <input id="correo" placeholder="Correo"><br><br>
  <button onclick="iniciarTrivia()">Comenzar</button>
</div>

<!-- ================= TRIVIA ================= -->
<div id="trivia" class="hidden">
  <h2 id="pregunta"></h2>
  <div id="opciones"></div>
</div>

<!-- ================= MENSAJE ================= -->
<div id="resultado" class="hidden">
  <h2 id="mensajeResultado"></h2>
  <button onclick="mostrarRuleta()">Girar la ruleta</button>
</div>

<!-- ================= RULETA ================= -->
<div id="ruleta" class="hidden">
  <h2>üé° Gira la ruleta</h2>
  <canvas id="canvas" width="400" height="400"></canvas><br>
  <button onclick="girarRuleta()">GIRAR</button>
</div>

<!-- ================= PREMIO ================= -->
<div id="premioFinal" class="hidden">
  <h2 id="textoPremio"></h2>
  <button onclick="reiniciar()">Volver al inicio</button>
</div>

<script>
/* ================= CONFIG ================= */
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyWb1iqA-ZfSIMCh0d-eC41_7kVGpiAMZ8SQflsga1q7OgyGIOUMd_IalCJmYHugNtl/exec;

/* ================= FORM ================= */
const nombreInput = document.getElementById("nombre");
const telefonoInput = document.getElementById("telefono");
const correoInput = document.getElementById("correo");

/* ================= TRIVIA ================= */
const preguntas = [
  {
    p: "¬øCapital de Colombia?",
    opciones: ["Medell√≠n", "Bogot√°", "Cali"],
    correcta: 1
  },
  {
    p: "¬ø2 + 2?",
    opciones: ["3", "4", "5"],
    correcta: 1
  },
  {
    p: "¬øColor del sol?",
    opciones: ["Amarillo", "Azul", "Verde"],
    correcta: 0
  }
];

let indice = 0;
let aciertos = 0;

/* ================= RULETA ================= */
let premios = [
  { nombre: "Premio 1", color: "#FFD700" },
  { nombre: "Premio 2", color: "#000000" },
  { nombre: "Premio 3", color: "#FFFFFF" }
];

let anguloActual = 0;
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

/* ================= FLUJO ================= */

function iniciarTrivia() {
  if (!nombreInput.value || !telefonoInput.value) return alert("Completa los datos");
  document.getElementById("formulario").classList.add("hidden");
  document.getElementById("trivia").classList.remove("hidden");
  mostrarPregunta();
}

function mostrarPregunta() {
  const q = preguntas[indice];
  document.getElementById("pregunta").innerText = q.p;
  const cont = document.getElementById("opciones");
  cont.innerHTML = "";

  q.opciones.forEach((op, i) => {
    const btn = document.createElement("button");
    btn.className = "opcion";
    btn.innerText = op;
    btn.onclick = () => validarRespuesta(btn, i);
    cont.appendChild(btn);
  });
}

function validarRespuesta(btn, i) {
  const correcta = preguntas[indice].correcta;
  const botones = document.querySelectorAll(".opcion");

  botones.forEach((b, idx) => {
    if (idx === correcta) b.classList.add("correcta");
    else if (idx === i) b.classList.add("incorrecta");
    b.disabled = true;
  });

  if (i === correcta) aciertos++;

  setTimeout(() => {
    indice++;
    if (aciertos >= 3) {
      mostrarResultado(true);
    } else if (indice < preguntas.length) {
      mostrarPregunta();
    } else {
      mostrarResultado(false);
    }
  }, 1200);
}

function mostrarResultado(gano) {
  document.getElementById("trivia").classList.add("hidden");
  document.getElementById("resultado").classList.remove("hidden");
  document.getElementById("mensajeResultado").innerText =
    gano ? "üéâ Ganaste premio" : "üò¢ No ganaste";

  enviarDatos(gano ? "GANA" : "PIERDE", "");
}

/* ================= RULETA ================= */

function mostrarRuleta() {
  document.getElementById("resultado").classList.add("hidden");
  document.getElementById("ruleta").classList.remove("hidden");
  dibujarRuleta();
}

function dibujarRuleta(resaltar = -1) {
  ctx.clearRect(0,0,400,400);
  const porcion = 2 * Math.PI / premios.length;

  premios.forEach((p, i) => {
    ctx.beginPath();
    ctx.fillStyle = p.color;
    ctx.moveTo(200,200);
    ctx.arc(200,200,180,i*porcion,(i+1)*porcion);
    ctx.fill();

    ctx.save();
    ctx.translate(200,200);
    ctx.rotate(i*porcion + porcion/2);
    ctx.textAlign = "right";
    ctx.font = "bold 20px Arial";
    ctx.fillStyle = p.color === "#000000" ? "white" : "black";
    ctx.fillText(p.nombre, 160, 5);
    ctx.restore();
  });
}

function girarRuleta() {
  const index = Math.floor(Math.random() * premios.length);
  const premio = premios[index];

  document.getElementById("ruleta").classList.add("hidden");
  document.getElementById("premioFinal").classList.remove("hidden");
  document.getElementById("textoPremio").innerText = "üéÅ Ganaste: " + premio.nombre;

  enviarDatos("GANA", premio.nombre);
}

/* ================= SHEETS ================= */

function enviarDatos(resultado, premio) {
  fetch(SCRIPT_URL, {
    method: "POST",
    mode: "no-cors",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      nombre: nombreInput.value,
      telefono: telefonoInput.value,
      correo: correoInput.value,
      aciertos,
      resultado,
      premio,
      fecha: new Date().toISOString()
    })
  });
}

/* ================= RESET ================= */

function reiniciar() {
  location.reload();
}
</script>

</body>
</html>
